description: >
  Deploy a helm chart

executor: helm-tools

parameters:
  deploy-tag:
    type: string
    default: "${CIRCLE_SHA1}"
    description: Image tag to use for deployments. Defaults to ${CIRCLE_SHA1}
  send-slack-alert:
    type: boolean
    default: true
    description: >
      Whether or not to send slack alerts to the deployment channel

steps:
  - checkout
  - deploy:
      deploy-tag: "<<parameters.deploy-tag>>"
  - when:
      condition: <<parameters.send-slack-alert>>
      steps:
        - slack/status:
            context: slack
            success_message: "Deployment success!"
            failure_message: "Deployment failure."
            include_project_field: true
            include_visit_job_action: true
